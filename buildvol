#!/bin/bash
  
# NOTE: THIS IS AN EXPERIMENTAL VERSION TRYING TO BUILD A MORE CAPABLE, MORE EFFICIENT COPYFILES FUNCTION.
  
# This is a script to build a clean set of SIG/M volumes from available sources.
  
# --------
# VERSIONS
# --------
#   The latest version of this script is available at https://github.com/CPMArchives/SIGM.
#
#   2022-05-06 - A major rewrite of several portions:
#              - A major rewrite of the copyfiles function, allowing the caller to optionally
#                specify a list of files to be copied from the source.
#              - Changes to the build of several volumes (59, 60, 80, 84, 85, 87, 93, 105,
#                172, 291, 292) to clean up CRC mismatches.
#              - Other minor changes and bug fixes.
#
#   2022-04-14 - I've forgotten to track changes. See the github site above if you're interested.
#
#   2022-04-06 - Set date of ARK, LBR, DSK dirs to release date of vol 310.
#   
#   2022-04-05 - Initial release.

# ------------
# REQUIREMENTS
# ------------

#  ISOs (all available from the *HUMONGOUS CP/M* Archives):
  
#    cpmdosgg.iso                                             http://cpmarchives.classiccmp.org/downloads/cpmdosgg_iso.zip
#    sourdough_jims_cpm_archive.iso                           http://cpmarchives.classiccmp.org/downloads/sourdough_jims_cpm_archive.iso.zip
#    nicholson.iso                                            http://cpmarchives.classiccmp.org/downloads/nicholson.iso
#    November_1994_Walnut_Creek_cpm_cdrom.iso                 http://cpmarchives.classiccmp.org/downloads/November_1994_Walnut_Creek_cpm_cdrom.iso.7z
#    cpmug.iso                                                http://cpmarchives.classiccmp.org/downloads/cpmug.iso
#    oakcpm.iso                                               http://cpmarchives.classiccmp.org/downloads/oakcpm.iso.7z
  
#   Place the above ISOs together in an accessible directory and point the var $iso_loc below to it. 

#  Utilities

#   Make sure these are available somewhere in your system path.

#       imdu - Dave Dunfield's ImageDisk utility              http://dunfield.classiccmp.org/img/index.htm ; https://oldcomputers-ddns.org/public/pub/manuals/imd.pdf
#       arc  - a utility for handling CP/M .ARK archives      Debian: sudo apt install arc ; Source: https://github.com/ani6al/arc
#       crck - a utility for generating CPM-style CRC values  http://cpmarchives.classiccmp.org/cpm/mirrors/oak.oakland.edu/pub/unix-c/cpm/crck.tar.Z
#   cpmtools - specifically cpmcp                             http://www.moria.de/~michael/cpmtools/ ; https://github.com/lipro-cpm4l/cpmtools/tree/cpm4l/cpmtools-2.21
#      mklbr - create .lbr archives                           https://github.com/ogdenpm/mklbr

# -----
# USAGE
# -----

#   Place this script somewhere on your system. Read these comments for details. Download the ISO images and make sure you 
#   have all the required utilities installed (see the REQUIREMENTS section above) and available in your system path. Then 
#   edit two variables in the VARIABLES section: $iso_loc and $buildroot. Or just place the ISOs and this script together 
#   in the current directory. You can now build a single volume; e.g.:

#     ./buildvol 228

#   Or the entire collection (on my system this takes a bit over five minutes):

#     for i in {1..310}; do ./buildvol $i; done

# ------- ----
# PROJECT GOAL
# ------- ----

# While there are several sources currently available for the SIG/M collection, none of them is "clean" or complete. Some
# sources have accreted a number of additional files (cf. Walnut Creek), have corrupted file names (ibid.), and/or have
# stripped CP/M record padding. This clean-up will focus on the following four areas:

# Complete Collection
# -------- ----------
# Individually, none of the sources has all 310 volumes; prominently, volumes 184-192 are missing from most such collections.
# By utilizing all known sources, I have been able to assemble a complete SIG/M collection, including the missing vols 184-192.

# Volume Content
# ------ -------
# Occasionally, files have gone missing from some sources. More commonly, some sources (looking at you, Walnut Creek), have
# accreted additional files. For volume content, -CATALOG and (where available) CRCKFILE are considered canonical. Only files
# listed there are included, with currently two exceptions: CRCKFILE and CRCK.COM. Both are often not listed in -CATALOG and,
# for obvious reasons CRCKFILE is not listed in CRCKFILE. Nevertheless, the presence of CRCKFILE is compelling regardless, 
# and in cases where CRCKFILE is present, it lists CRCK.COM even when -CATALOG does not. So even where CRCK.COM is not listed
# in either -CATALOG or CRCKFILE, it may be included. Exceptions are going to be Vols 1-18 where no CRCs are provided, so
# the inclusion of CRCK.COM would serve no purpose.

# File Names
# ---- -----
# File names have suffered a number of corruptions. Some characters, such as /, @ and +, which are legal under CP/M, are prob-
# lematic under other file systems, and are often found altered. / is a special problem, which has played havoc in UNIX environ-
# ments (cf. volume 195 on the Walnut Creek CD). It is stored properly as / inside the ARK, LBR and DSK images created here, but
# as _ (underscore) on the host system.

# File Dates
# ---- -----
# The CP/M file system had no capacity for storing file dates, so the original files had none. The decision has been made to
# set dates on individual files to match their volume's release date, but keep in mind that these, too, are not original dates.

# File Integrity
# ---- ---------
# CP/M had no facility for recording exact file sizes, but stored files in 128-byte records. Thus typically a file, unless it
# happened to be exactly some multiple of 128 bytes in length, was padded with a number of "garbage" bytes (commonly 1AH, since
# CP/M filled freshly formatted disks with 1AH which also doubled as an end-of-file marker for text files under CP/M) to the next
# 128-bytes. However, when the SIG/M collection passed through other OSes text files often lost this padding. Though not detri-
# mental, this resulted in CRCs which no longer match those in -CATALOG or CRCKFILE listings. This project restores the padding
# to all files that are not an exact multiple of 128 bytes in length, restoring in almost all cases original CRCs.

#----------
# VARIABLES
#----------

   vol=$1
   low=1 ; high=310                                                  # Define the acceptable range of vol nums
   [[ -z "$iso_loc" ]] && iso_loc=$(pwd)                             # Where you SIG/M source ISOs are (default current dir)
   [[ -z "$buildroot" ]] && buildroot=$(pwd)                         # Where the rebuilt vols will be saved (default curr dir); 
   mkdir -p $buildroot                                               # each will be in a subdir called vol###/

  # Make sure user supplied a valid volume number.
  [[ -z $1          ]]   && { echo "You must specify a volume between $low and $high; e.g., $0 52"   ; exit 1; }
  while [ "$(echo ${vol:0:1})" == "0" ]; do vol=$(echo $vol | cut -b2-); done  # strip all leading zeroes
  [[ $1 =~ ^[0-9]+$ ]]   || { echo "$1 is not a number. Try again."                                  ; exit 1; }
  [[ "$vol" -lt $low  ]] || [[ "$vol" -gt $high ]] && { echo "Enter a number between $low and $high."; exit 1; }
  vol=`printf %03d $vol`
  builddir=$buildroot/sigmv$vol ; rm -rf $builddir > /dev/null 2>&1 ; mkdir -p $builddir
  
# ---------
# FUNCTIONS
# ---------

#    SOURCE - Mounts the source specified ("cpmdosgg", "oak", etc.) in preparation to copy the files.
# COPYFILES - Copies files from the source, uppercasing all filenames. Also corrects a few corrupted names.
#COPYFILES2 - Major rewrite of COPYFILES
# DATEFILES - Sets the file datestamps to the date of release of that volume; in most cases pulls the date from -CATALOG.
#  CHECKCRC - an attempt to automate CRC comparison, but it may be hopelessly messy. Not currently used.
#  DISMOUNT - Unmount the source mounted with SOURCE.
#    RENAME - Renames files.
#       ARK - Creates a VOL###.ARK archive file. Requires cpmtools.
#       DSK - Creates an IBM-3740-format disk image for use in CP/M emulators.
#       LBR - Creates a CP/M-style LBR archive.
#  ARCHIVES - Master routine that calls ARK, DSK and LBR.
#    REMOVE - Deletes files.                       
#       PAD - Pads file lengths with 1AH out to 128-byte multiples.
#     NOTES - Spit out some notes at the end.

# ------------
  source () { 
# ------------
  # Sources for the SIG/M collections are various ISO images from *HUMONGOUS* CP/M: nicholson.iso, cpmdosgg.iso, cpmug.iso, 
  # sourdough_jims_cpm_archive.iso, November_1994_Walnut_Creek_cpm_cdrom.iso and oakcpm.iso, placed in a single location 
  # which is specified in $iso_loc above.
  
  # The rest of this script assumes $src is pointed at the source from which the volume's content will be pulled. This 
  # function's job is to point $src at the right place depending on which collection is being used for the source. E.g., if 
  # nicholson is specified as the source and the volume is24: mount nicholson.iso to $tempdir, then point $src at 
  # $tempdir/extract/cpmug025.
  
  tempdir=$(pwd)/temp                                                # a working directory where the source iso will be mounted
  mountpoint -q $tempdir && sudo umount -l $tempdir > /dev/null 2>&1 # ensure a fresh tempdir
  [[ -d $tempdir ]] && rm -rf $tempdir              > /dev/null 2>&1
  mkdir -p $tempdir                                 > /dev/null 2>&1
  
  # You can change these if you want. $iso_loc is set in VARIABLES above.

   cpmdosgg_iso=$iso_loc/cpmdosgg.iso
      cpmug_iso=$iso_loc/cpmug.iso 
       nich_iso=$iso_loc/nicholson.iso 
         wc_iso=$iso_loc/November_1994_Walnut_Creek_cpm_cdrom.iso
        oak_iso=$iso_loc/oakcpm.iso 
  sourdough_iso=$iso_loc/sourdough_jims_cpm_archive.iso  

  case $1 in
     cpmdosgg) # SIG/M vols 1-280 are found in CPMDOSGG dirs cpm10/, cpm11/ and cpm12/.
               mkdir -p $tempdir
               [[ -f $cpmdosgg_iso ]] && sudo mount $cpmdosgg_iso  $tempdir/ > /dev/null 2>&1 || { echo $(basename $cpmdosgg_iso) not found. Specify the location of your ISO files with:; echo ""; echo "export iso_loc=/path/to/ISOs"  ; exit 1; } 
               src=$tempdir/cpm1${vol:0:1}/1$vol/
               ;;
        cpmug) # SIG/M vols 2, 4, etc. are duplicated in CPMUG vols 56, 58, etc.
               mkdir -p $tempdir
               [[ -f $cpmug_iso ]] && sudo mount $cpmug_iso     $tempdir/ > /dev/null 2>&1 || { echo $(basename $cpmug_iso) not found. Specify the location of your ISO files with:; echo ""; echo "export iso_loc=/path/to/ISOs"   ; exit 1; }
               [[ $vol == 002 ]] && src=$tempdir/cpmug056
               [[ $vol == 004 ]] && src=$tempdir/cpmug058
               [[ $vol == 005 ]] && src=$tempdir/cpmug059
               [[ $vol == 006 ]] && src=$tempdir/cpmug060
               [[ $vol == 011 ]] && src=$tempdir/cpmug057
               [[ $vol == 015 ]] && src=$tempdir/cpmug067
               ;;
    nicholson) # nicholson is a bit complicated. A partial SIG/M set is found in .IMD format in the sigm/ directory. Also, 
               # the directory extracted/ contains subdirs holding, apparently, the extracted contents of those IMD images. 
               # I'm not sure why I did  that. Assuming the code below, using the imdu and cpmcp to extract the contents
               # works, just go with that. The way this code is currently structured, it seems to set up the extract/ source, 
               # then just switch to the IMD image anyway.
    
               mkdir -p $tempdir
               [[ -f $nich_iso ]] && sudo mount $nich_iso      $tempdir/ > /dev/null 2>&1 || { echo $basename $nich_iso not found. Specify the location of your ISO files with:; echo ""; echo "export iso_loc=/path/to/ISOs"   ; exit 1; }
               [[ -d $tempdir/extract/sigm$vol/     ]] && src=$tempdir/extract/sigm$vol/
               [[ -f $tempdir/sigm/sigm$vol.imd     ]] && { 
                 imdu -b $tempdir/sigm/sigm$vol.imd ./sigm$vol.dsk > /dev/null 2>&1
                 sudo umount -l $tempdir > /dev/null 2>&1
                 cpmcp -f ibm-3740 ./sigm$vol.dsk 0:*.* $tempdir/
                 rm -f ./sigm$vol.dsk
                 src=$tempdir
                 }
               ;;
           wc) # The Walnut Creek CD's copy of SIG/M is in simtel/sigm/ subdirs vols000/, vols100/, vols200/ and vols300/.
               mkdir -p $tempdir
               [[ -f $wc_iso ]] && sudo mount $wc_iso        $tempdir/ > /dev/null 2>&1 || { echo $wc_iso not found. Specify the location of your ISO files with:; echo ""; echo "export iso_loc=/path/to/ISOs"   ; exit 1; }
               src=$tempdir/simtel/sigm/vols${vol:0:1}00/vol$vol/
               ;;
          oak) # OAK's collection is in some ways the most complicated. While its collection is nearly complete complete 
               # (lackings vols 184-192), it is a mixture of expanded subdirs and .ARK archive files. Thus depending on the 
               # vol it can either be pulled from the expanded dir, or extracted from the .ARK archive.          
               mkdir -p $tempdir
               [[ -f $oak_iso ]] && sudo mount $oak_iso       $tempdir/ > /dev/null 2>&1 || { echo $oak_iso not found. Specify the location of your ISO files with:; echo ""; echo "export iso_loc=/path/to/ISOs"   ; exit 1; }
               [[ -d $tempdir/sigm/vol$vol/ ]] && src=$tempdir/sigm/vol$vol/ || {
                  curdir=$(pwd)
                  sudo cp $tempdir/sigm/sigmv$vol.ark $curdir/ # for some reason fails without sudo
                  sudo umount -l $tempdir > /dev/null 2>&1
                  cd $tempdir
                  arc ne $curdir/sigmv$vol.ark
                  cd $curdir/ > /dev/null 2>&1
                  rm -rf ./sigmv$vol.ark
                  curdir=
                  src=$tempdir
                  }
               ;;
    sourdough) # Sourdough's SIG/M collection is in library_collections/sigm/. Like OAK, it is a mixture of expanded
               # dirs and .ARK archives.
               mkdir -p $tempdir
               [[ -f $sourdough_iso ]] && sudo mount $sourdough_iso $tempdir/ > /dev/null 2>&1 || { echo $sourdough_iso not found. Specify the location of your ISO files with:; echo ""; echo "export iso_loc=/path/to/ISOs"   ; exit 1; }
               [[ -d $tempdir/library_collections/sigm/vol$vol/ ]] && src=$tempdir/library_collections/sigm/vol$vol || {
                  curdir=$(pwd)
                  cp $tempdir/library_collections/sigm/sigmv$vol.ark $curdir
                  sudo umount -l $tempdir > /dev/null 2>&1
                  cd $tempdir
                  arc ne $curdir/sigmv$vol.ark
                  cd $curdir/ > /dev/null 2>&1
                  rm -f $curdir/sigmv$vol.ark
                  curdir=
                  src=$tempdir
                  }
               ;;
  esac
  
  echo ""
  echo ""
  echo "============"                # Tell user where the contents are being pulled from
  echo "SIG/M VOL$vol Files from $1"
  echo "============"
  }  
  
# ------------
  OLD_copyfiles () {
# ------------
    echo ""
    echo "  Copying files"
    echo "    ----"
    echo "    From $src"
    for f in $src/* ; do cp $f $builddir/$(basename $f | tr 'a-z' 'A-Z') >/dev/null 2>&1; done  # Uppercase all filename
    for i in ./_SIGM ./-SIGM ./_SIG_M ./-SIG_M; do                              # Some collections added variants of -SIGM.xxx as volume; careful of SIG_M.$vol (see vol 2); it's legit.
    [[ -f $builddir/$i.$vol ]] && rm -rf $builddir/$i.$vol >/dev/null 2>&1      # labels. They're not original, so clean them out.
    done                                                                        

    for i in ./_CATALOG ./CATALOG; do                                           # Rename -CATALOG
      [[ -f $builddir/$i.$vol ]] && mv $builddir/$i.$vol $builddir/-CATALOG.$vol >/dev/null 2>&1
    done  

    for i in ./SIG_M.LIB ./SIG\$M.LIB ./SIG-M.LIB; do                           # Rename SIG/M.LIB
      [[ -f $builddir/$i ]] && mv $builddir/$i $builddir/SIG_M.LIB >/dev/null 2>&1
    done  

    sudo chmod 777 $builddir/*   # Some vols (e.g., 104) give "Permission denied" when the script attempts to pad the files

    echo "    ----"
  }

# ------------
  copyfiles () {
# ------------

    # Copy files. Invoked as: copyfiles source [filename] [filename] [...]  
    #
    # source is required and is one of wc, cpmug, oak, etc. (see function source above). You may optionally 
    # specify a list of files to copy (no wildcards); if no files are specified, all files will be copied.
    #
    # No error checking is done so make sure you have everything correct!

    source $1                                                                                     # first parameter specifies the source to use

    echo ""
    echo "  Copying files"
    echo "    ----"
    echo "    From $src"
    shift                                                                                         # discard the first param, leaving only the file list
    [[ -z "$1" ]] && {                                                                            # if no files were specified, assume *.*
      for f in $src/* ; do cp $f $builddir/$(basename $f | tr 'a-z' 'A-Z') >/dev/null 2>&1; done  # Uppercase all filename
      for i in ./_SIGM ./-SIGM ./_SIG_M ./-SIG_M; do                                              # Some collections added variants of -SIGM.xxx as volume; careful of SIG_M.$vol (see vol 2); it's legit.
        [[ -f $builddir/$i.$vol ]] && rm -rf $builddir/$i.$vol >/dev/null 2>&1                    # labels. They're not original, so clean them out.
      done                                                                        

      for i in ./_CATALOG ./CATALOG; do                                                           # Rename -CATALOG
        [[ -f $builddir/$i.$vol ]] && mv $builddir/$i.$vol $builddir/-CATALOG.$vol >/dev/null 2>&1
      done  

      for i in ./SIG_M.LIB ./SIG\$M.LIB ./SIG-M.LIB; do                                           # Rename SIG/M.LIB
        [[ -f $builddir/$i ]] && mv $builddir/$i $builddir/SIG_M.LIB >/dev/null 2>&1
      done  
    } || for f in $@; do cp $src/$f $builddir/$(basename $f | tr 'a-z' 'A-Z') >/dev/null 2>&1; done
  
    sudo chmod 777 $builddir/*                                                                    # Some vols (e.g., 104) give "Permission denied" when the script attempts to pad the files
    dismount
    echo "    ----"
  }

# ------------
  datefiles () {
# ------------              
  # SIG/M began in about Sept 1980. Early volumes (prior to vol 43) didn't include release dates.
  # Release dates used here are gleaned largely from the SIG/M newsletters on SIG/M Vol 51 but in 
  # most cases only the month can be gleaned. It would seem reasonable to call the date of that
  # month's SIG/M meeting the official date, but in most cases that date is unknown (Jun '81 is
  # the exception; the 7/81 newsletter tells us it was June 12th). So the 15th of that month
  # is arbitrarily assigned.
    case $vol in            
      001) date=19801015 ;; # The 11/80 newsletter mentions three vols already available
      002) date=19801015 ;; # and says four more would be released at that month's SIG/M 
      003) date=19801015 ;; # meeting.
      004) date=19801115 ;; 
      005) date=19801115 ;; 
      006) date=19801115 ;; 
      007) date=19801115 ;; 
      008) date=19801215 ;; # No mention of vols 8-11 in the SIG/M newsletters, so for no
      009) date=19810115 ;; # good reason, just assigning one per month until vol 12.
      010) date=19810215 ;; 
      011) date=19810315 ;; 
      012) date=19810415 ;; 
      013) date=19810415 ;; 
      014) date=19810415 ;; 
      015) date=19810415 ;; 
      016) date=19810415 ;; 
      017) date=19810515 ;; # The 5/81 newsletter mentions vols 17 and 18 as released
      018) date=19810515 ;; 
      019) date=19810612 ;; # 6/81 calls vols 12-25 "new releases"
      020) date=19810612 ;; 
      021) date=19810612 ;; 
      022) date=19810612 ;; 
      023) date=19810612 ;; 
      024) date=19810612 ;; 
      025) date=19810612 ;; 
      026) date=19810901 ;; # 8/81 says 11 vols will be released in July/Aug. Then
      027) date=19810901 ;; # 9/81 lists vols 26-38.
      028) date=19810901 ;; 
      029) date=19810901 ;; 
      030) date=19810901 ;; 
      031) date=19810901 ;; 
      032) date=19810901 ;; 
      033) date=19810901 ;; 
      034) date=19810901 ;; 
      035) date=19810901 ;; 
      036) date=19810901 ;; 
      037) date=19810901 ;; 
      038) date=19810901 ;; 
      039) date=19811015 ;; # 10/81 lists vols 39-42
      040) date=19811015 ;; 
      041) date=19811015 ;; 
      042) date=19811015 ;; 
      052) date=19820101 ;; # No release date; assuming Vol 51/53's date.
      055) date=19820205 ;; # No release date; interpolating between vols 54/56.
      059) date=19820317 ;; # -CATALOG malformatting chokes date extraction; specifying manually.
      092) date=19830114 ;; # -CATALOG malformatting chokes date extraction; specifying manually.
      093) date=19830115 ;; # -CATALOG malformatting chokes date extraction; specifying manually.
      118) date=19830614 ;; # -CATALOG malformatting chokes date extraction; specifying manually.
      128 | 129) date=19830909 ;; # -CATALOG date formatting screws up the extraction code; specifying the date manually.
      135) date=19830901 ;; # -CATALOG date formatting screws up the extraction code; specifying the date manually.
      153) date=19840206 ;; # -CATALOG date formatting screws up the extraction code; specifying the date manually.
      291 | 292 | 293 | 294) date=19861121 ;; # -CATALOG date formatting screws up the extraction code; specifying the date manually.
      295 | 296 | 297 | 298 | 299) date=19870815 ;; # No release date. Assuming it goes with vol 296.
      300 | 301) date=19870915 ;; # Release dates for vols 296-310 are MM/YY only. The 15th of those months is arbitrarily assigned.
      302 | 303) date=19871115 ;; 
      304 | 305 | 306 | 307 | 308 | 309 | 310) date=19880315 ;; 
        *) date=$(grep released $builddir/-CATALOG.$vol | rev | cut -d' ' -f1-3 | rev) ;;
    esac      
    echo ""
    echo "  VOLDATE"
    echo "    ----"
    echo "    $date"
    echo "    ----"
    touch -d "$date" $builddir/*
    touch -d "$date" $builddir
  } 
  
# ------------
  checkcrc () {
# ------------

    # Verify file integrity by comparing the file's actual CRC with the CRC listed in -$crcfile. Here's a sample -CATALOG file listing, for ADDADR.ASM:
    #    49.01   ADDADR  .ASM     1K     3B 9E   Accounts Payable/Receivable

    # So 1) get the file's actual CRC with cpmcrck. 2) grep the file listing in -CATALOG and extract the CRC value (3B 9E above) from it. 3) Compare.
    
    cd $builddir >/dev/null 2>&1
    echo ""
    echo "  File Integrity"
    echo "    ----"
    
    # A combination of $fields and $bytes is used to extract the file's listed CRC value from $crcfile. $crcfile is one of CRCKFILE.$vol, CRCKLIST.$vol or -CATALOG.$vol.
    
    crcfile="./-CATALOG.$vol" ; fields="-f3" ; bytes="-b13-17" # defaults

    # For most volumes, the above defaults work. Put exceptions here. Note $((10#$vol))) converts to base 10
    # which strips the leading zero (e.g., 049 --> 49), which would cause BASH to interpret it as a hex value.
    # Note: this is for volume-wide settings. Any individual file within a volume that needs special attention
    # is handled below.
    
    [[ $(echo $((10#$vol))) -le  18 ]]                                       && { echo "    No CRCs available"  ; echo "    ----" ; return      ; } # Vols 1-18 no CRCs
    [[ $(echo $((10#$vol))) -le  25 ]]                                       && { crcfile="./CRCKFILE.$vol" ; fields="-f2"    ; bytes="-b12-16" ; } # Vols 19-25
    [[ $(echo $((10#$vol))) -ge  26 ]] && [[ $(echo $((10#$vol))) -le  48 ]] && { crcfile="./CRCKLIST.$vol" ; fields="-f2"    ; bytes="-b12-16" ; } # Vols 26-48
    [[ $(echo $((10#$vol))) -ge  49 ]] && [[ $(echo $((10#$vol))) -le  50 ]] && {                                               bytes="-b9-13"  ; } # Vols 49-50
    [[ $(echo $((10#$vol))) -eq  51 ]] &&                                       {                                               bytes="-b5-9"   ; } # Vol  51
    [[ $(echo $((10#$vol))) -ge  52 ]] && [[ $(echo $((10#$vol))) -le  75 ]] && {                                               bytes="-b9-13"  ; } # Vols 52-75
    [[ $(echo $((10#$vol))) -eq  76 ]] || [[ $(echo $((10#$vol))) -eq  78 ]] && {                                               bytes="-b11-15" ; } # Vols 76, 78
    [[ $(echo $((10#$vol))) -ge  83 ]] && [[ $(echo $((10#$vol))) -le  84 ]] && {                                               bytes="-b11-15" ; } # Vols 83, 84
    [[ $(echo $((10#$vol))) -ge  86 ]] && [[ $(echo $((10#$vol))) -le  93 ]] && {                                               bytes="-b11-15" ; } # Vols 86-93
    [[ $(echo $((10#$vol))) -ge  94 ]] && [[ $(echo $((10#$vol))) -le 114 ]] && {                                               bytes="-b12-16" ; } # Vols 94-114

    # Cycle through the files in the current volume.
    
    for i in ./*; do

      actualcrc="$(cpmcrck $i | tail -1 | cut -b46-50 | tr 'a-z' 'A-Z')"            # get the file's actual CRC

      # break out name and extension portions of filename, and build $expandedname.
      
      f=$(basename $i) 
      name=$(echo $f | cut -d'.' -f1)                                               # strip './' and grab filename portion without extension
      ext=$( echo $f | cut -d'.' -f2); [[ $ext == $name ]] && ext="   "             # grab filename ext only; set to '   ' if none
#      while [[ ${#name} -le 7 ]]; do name="name ";done
#      while [[ ${#ext}  -le 2 ]]; do ext="$ext " ;done
#      echo ":$name.$ext:"
#      read -p "CONT..."
      expandedname="$(printf "%-8.15s.%s" $name $ext)"                              # Pad out to full 8.3; e.g., "CRC.COM" to 'CRC     .COM'

      [[ ! "$ext" == "$vol" ]] && [[ ! "${f:0:1}" == "-" ]] && { # Skip any file whose extension is the vol number (-CATALOG.049) or whose name starts with -.

        # Sometimes an individual file's entry in -CATALOG is formatted differently from the rest. In that case, we'll
        # need to individually specify values for that file only.
      
        orgbytes=$bytes                                                             # Save current value for later restoration

        case $f in
           "ARCUSTM.DCL" )                  bytes="-b10-14" ;;                      # Vol 49
          "CHGLIB22.LBR" )                  bytes="-b10-14" ;;                      # Vol 250
          "PRAELUD1.SNG" | "SCARLATI.SNG" ) bytes="-b10-14" ;;                      # Vol 57
            "FLS-11.COM" )                  bytes="-b16-20" ;;                      # Vol 60
                  "NEWS" )                  bytes="-b11-15" ;;                      # Vol 249
              "SYOPMENU" )                  bytes="-b10-14" ;;                      # Vol 249
        esac
          
        # Define the name to grep for in $crcfile. Can add exceptions for individual files.
        
        case $expandedname in 
          "PISTOL  .C"   ) grepname="PISTOL  .C "                                       ;; # Vols 59, 114; add space to avoid matching PISTOL.COM or PISTOL.CRC
          "XLISP   .C"   ) grepname="XLISP   .C "                                       ;; # Vols 118,153; add space to avoid matching XLISP.COM
          "SCRUB   .C"   ) grepname="SCRUB   .C "                                       ;; # Vol  157    ; add space to avoid matching SCRUB.COM
          "READ    .ME"  ) grepname="READ    .ME "                                      ;; 
          "CRC     .COM" ) [[ $(echo $((10#$vol))) -eq 89  ]] || [[ $(echo $((10#$vol))) -eq 108 ]] && grepname="CRC    .COM" ;;  # Vol 89  CRC.COM is improperly listed as "CRC    .COM" (only three spaces)
          "GLOBALS .RN$" ) grepname="GLOBALS .RN"                                       ;; # Vol 134
          "HELP    .COM" ) [[ $(echo $((10#$vol))) -eq 89  ]] && grepname="HELP   .COM" ;; # Vol 89 HELP.COM is improperly listed as "HELP   .COM" (only three spaces)
          "JOIN    .ACG" ) [[ $(echo $((10#$vol))) -eq 89  ]] && grepname="JOIN.ACG"    ;; # Vol 146
          "PASZCODE.RN$" ) grepname="PASZCODE.RN"                                       ;; # Vol 134
          "MDBSGETM.PLI" ) grepname="MDBSGETM.PL"                                       ;; # Vol 49
          "PRICES  .DOC" ) grepname="PRICES.DOC"                                        ;; # Vol 53
          "SIG_M   .LIB" ) [[ $(echo $((10#$vol))) -eq 146 ]] && grepname="SIG/M.LIB" || grepname="SIG/M   .LIB" # Vol 146
                           [[ $(echo $((10#$vol))) -ge 193 ]] && grepname="SIG-M   .LIB"   # Vols 193-310
                           ;;
          "TESTPROT.BAS" ) grepname="TestProt.BAS" ;; # Vol 52
          "Z2SYS-1 .MOD" ) grepname="Z2SYS-1.MOD"                                       ;; # Vol 108
                        *) grepname=$(echo "$expandedname" | tr '_' '/')                ;; # Replace _ with / before grepping.
        esac
  
        # Search for $grepname in $crcfile. Report if not found. If found, extract the CRC.
        grep -i "$grepname" $crcfile >/dev/null || echo "    $expandedname not listed in $crcfile" # VOL $vol >> ~/projects/sigm/notlisted
        grep -i "$grepname" $crcfile >/dev/null && { 
          case $f in
            # Some files are listed, but without CRCs, so CRCs are manually supplied here. Some have undergone revisions and require multiple CRCs.
            # To check all the CRCs of a file, go to $buildroot and run:
            #    fn=CRC.COM; for i in {001..310}; do   [[ -f sigmv$i/$fn ]] && cpmcrck sigmv$i/$fn | tail -1; done
            "CRC.CMD"      ) expectedcrc=10E5 ;;                                                          
            "CRC.COM"      )                                       expectedcrc=B207
                             [[ $(echo $((10#$vol))) -eq 102 ]] && expectedcrc=BB23
                             [[ $(echo $((10#$vol))) -ge 216 ]] && expectedcrc=EE87
                             [[ $(echo $((10#$vol))) -ge 295 ]] && expectedcrc=CB3E
                             [[ $(echo $((10#$vol))) -eq 296 ]] && expectedcrc=053B
                             [[ $(echo $((10#$vol))) -eq 299 ]] && expectedcrc=EE87
                             [[ $(echo $((10#$vol))) -ge 300 ]] && expectedcrc=B207
                             ;;                 
            "CRCK.COM"     ) expectedcrc=2D47 ;;
            "DELBR.COM"    ) expectedcrc=EF3A ;; 
            "HELP.COM"     ) expectedcrc=D6CC ; [[ $(echo $((10#$vol))) -eq 102 ]] && expectedcrc=3447 ; [[ $(echo $((10#$vol))) -ge 186 ]] && expectedcrc=928B ;;
            "JOIN.ACG"     ) expectedcrc=83E7 ; [[ $(echo $((10#$vol))) -ge 153 ]] && expectedcrc=9B11 ; [[ $(echo $((10#$vol))) -ge 174 ]] && expectedcrc=83E7 ; [[ $(echo $((10#$vol))) -ge 282 ]] && expectedcrc=A289 ; [[ $(echo $((10#$vol))) -ge 295 ]] && expectedcrc=83E7 ;;
            "JOIN.AZG"     ) expectedcrc=3EC0 ; [[ $(echo $((10#$vol))) -ge 305 ]] && expectedcrc=3E32 ;;
            "LTYPE.COM"    ) expectedcrc=AC16 ;;                                                          
            "LU.COM"       ) expectedcrc=3D98 ; [[ $(echo $((10#$vol))) -ge 157 ]] && expectedcrc=BA32 ;; 
            "LU86.CMD"     ) expectedcrc=1723 ;;   
            "MDBSGETM.PLI" ) expectedcrc=B7A1 ;; # Vol 49
            "PRICES.DOC"   ) expectedcrc=6CC7 ;; # Vol 53
            "READTHIS"     )                                       expectedcrc=2AE0 # Vols 164-166
                             [[ $(echo $((10#$vol))) -eq 173 ]] && expectedcrc=BB80 
                             [[ $(echo $((10#$vol))) -eq 197 ]] && expectedcrc=58FF
                             ;;                 
            "READ.ME"      ) [[ $(echo $((10#$vol))) -eq 184 ]] && expectedcrc=D9F5 ;; # Vol 184
            "READTHIS.1ST" ) expectedcrc=CCAE ;; # Vol 168
            "REGIONS.SIG"  ) expectedcrc=3214 ; [[ $(echo $((10#$vol))) -ge 252 ]] && expectedcrc=FD05 ;;
            "SHOW.COM"     ) expectedcrc=F628 ;; 
            "SIG_M.LIB"    )                                       expectedcrc=C9BE
                             [[ $(echo $((10#$vol))) -eq 104 ]] && expectedcrc=93AE
                             [[ $(echo $((10#$vol))) -ge 118 ]] && expectedcrc=1539
                             [[ $(echo $((10#$vol))) -ge 200 ]] && expectedcrc=D31C
                             [[ $(echo $((10#$vol))) -ge 208 ]] && expectedcrc=15CA
                             [[ $(echo $((10#$vol))) -eq 243 ]] && expectedcrc=0C6F
                             [[ $(echo $((10#$vol))) -eq 253 ]] && expectedcrc=0C6F
                             [[ $(echo $((10#$vol))) -ge 278 ]] && expectedcrc=0C6F
                             [[ $(echo $((10#$vol))) -ge 291 ]] && expectedcrc=F4DD
                             [[ $(echo $((10#$vol))) -ge 295 ]] && expectedcrc=15CA
                             ;;                 
            "SIG/M.LIB"    ) expectedcrc=C9BE ;;                                                          
            "SIG-M.LZB"    ) expectedcrc=F286 ;;                                                          
            "TYPE1.COM"    ) expectedcrc=56FB ; [[ $(echo $((10#$vol))) -ge 184 ]] && expectedcrc=FFD7 ;; 
            "USQ.COM"      ) expectedcrc=561F ; [[ $(echo $((10#$vol))) -ge 152 ]] && expectedcrc=5621 ; [[ $(echo $((10#$vol))) -ge 176 ]] && expectedcrc=7D52 ;;
            "USQ.CMD"      ) expectedcrc=24C0 ; [[ $(echo $((10#$vol))) -ge 175 ]] && expectedcrc=F46E ; [[ $(echo $((10#$vol))) -ge 207 ]] && expectedcrc=24C0 ; [[ $(echo $((10#$vol))) -ge 210 ]] && expectedcrc=EB7C ; [[ $(echo $((10#$vol))) -ge 229 ]] && expectedcrc=0CAF ;;
            "Z2SYS-1.MOD"  ) expectedcrc=3DF1 ;; # Vol 108
            "ZCPR2.IDX"    ) expectedcrc=63C6 ; [[ $(echo $((10#$vol))) -ge 124 ]] && expectedcrc=0BA7 ;;
            "ZCPR3.CAT"    ) expectedcrc=95F2 ;;
                          *) expectedcrc=$(grep -a "$grepname" $crcfile | cut -d'.' $fields | cut $bytes | tr -d [:space:] | cut -b1-4) ;;
          esac                 
          
          # Finally, if the actual and listed CRCs don't match, report it.
          
          [[ ! "$actualcrc" == "$expectedcrc" ]] && echo "    Vol $vol: $expandedname CRC mismatch **** ACTUAL: $actualcrc EXPECTED: $expectedcrc" # VOL $vol >> ~/projects/sigm/mismatches
        }

       bytes=$orgbytes # restore original value in case it was altered, so the rest of the files in this volume aren't processed with the wrong value.
       }  
    done

    echo "    ----"
    #read -p "Continue..."
    cd - >/dev/null 2>&1
  }
  
# ------------
  dismount () {
# ------------
    mountpoint -q $tempdir > /dev/null 2>&1 && sudo umount -l $tempdir > /dev/null 2>&1
    rm -rf $tempdir > /dev/null 2>&1
  }
  
# ------------
  rename () {
# ------------
    # To rename single files (each pair wrapped in quotations):
    #   rename './oldname ./newname' './oldname ./newname'
    
    # To batch rename a wildcarded spec:
    #   rename 'DU_*.*'

    # NOTE: Use the wildcarded option only when you wish to
    # replace _ with -. If you wish to replace _ with some
    # other char, use single file format.
    
    cd $builddir >/dev/null 2>&1 
    echo ""
    echo "  Rename"
    echo "    ----"
    for i in "$@"; do 
      echo "$i" | grep "*" > /dev/null && { 
        for j in $i; do
          echo "    $j $(echo $j | tr '_' '-')"
          mv $j $(echo $j | tr '_' '-')
          done
        } || { echo "    $i"; mv $i; }
    done
    [[ -f "SIG-M.LIB" ]] && mv SIG-M.LIB SIG_M.LIB # In case SIG_M.LIB got caught up in any wildcard sweeps, name it back
    echo "    ----"
    cd - >/dev/null 2>&1 
#    echo "    $1  to $2"
#    mv $builddir/$1  $builddir/$2
  }
  
# ------------
  ark () {
# ------------
    which arc    &> /dev/null 1>&2 || { echo "arc util not found"     ; return; }
    dest=$buildroot/ARK; arkname=$dest/SIGMV$vol.ARK
    cd                   $builddir                  &> /dev/null 1>&2
    mkdir -p             $dest                      &> /dev/null 1>&2
    [[ -f                $arkname ]] && rm $arkname &> /dev/null 1>&2  # remove any previous version

    # build archive
    arc a                $arkname ./*               &> /dev/null 1>&2

    # On my Linux system I'm using arc v5.21r, which translates between / and :. But on the host system, I've replaced / with _, which arc 
    # doesn't pick up, so here I'll manually convert _ to / inside the ARK files. Note that arc will translation / to : when listing or
    # extracting the ARK contents, but internally it is stored as /.

    for j in ./*; do {
      oldname=$(echo $(basename $j) | cut -d'.' -f1)                              # filename with _
      newname=$(echo $oldname | tr '_' '/')                                       # filename with /
      [[ ! "$oldname" == "$newname" ]] && sed -i "s|$oldname|$newname|g" $arkname # could also do something like echo $newname | grep "/"
      }
    done
    
    touch -r .           $arkname                   &> /dev/null 1>&2  # set datestamp of ARK
    touch -d "19880315"  $dest                                         # set datestamp of ARK dir to date of most recent SIG/M volume (i.e., vol 310)
    
    # clean up
    cd -                                            &> /dev/null 1>&2
    echo "    $(basename $arkname)"
  }
  
# ------------
  dsk () {
# ------------

    # IBM-3740-format images are created as I had made the assumption that SIG/M volumes were 
    # originally transferred on IBM-3740 disks. It appears other formats were also supported
    # (note it specifies only "8 inch"; it's only an assumption that was IBM-3740).
    
    # The 5/81 SIG/M Newsletter (see Vol 51) indicates the following formats were offered:
    
    #     8 inch single density     
    #      TRS-80 Model 2           
    # 5 1/4 inch  varieties:
    #      Micropolis Mod II        
    #      Northstar (SS/SD)        
    #                (SS/DD)        
    #      TRS-80    Model 1        
    #                Model 3        
    #      Apple    (13 sector)     
    #               (16 sector)     
    #      Cromemco  (SS/SD)        
    
    # While 6/81 said:
    
    # All SIG/M libraries on:     are up to volume:
    #                    8 Inch           25
    #                    Northstar DD     25
    #                    Micropolis ModII 25
    #                  * Apple CPMUG      n/a yet
    #                  * TRS-80 Mod 1/3   n/a yet
    #                           Mod 2     25  CP/M
    #                  * H-89             n/a yet
    #                  * Superbrain       n/a yet
    #  * means its in the process of creation
    
    # And 11/81 said:
    
    # We  are  officially  supporting  the following  5  and  1/4  inch formats:

    #  Micropolis Mod 2 (1 diskette per volume)
    #  North Star double density (2 diskettes per volume)
    #  TRS80 Mod 1 and 3 (3 to 4 diskettes per volume)
    #  Apple 2 (3 to 4 diskettes per volume)

    which mkfs.cpm &> /dev/null 1>&2 || { echo "mkfs.cpm util not found"; return; }
    which cpmcp    &> /dev/null 1>&2 || { echo "cpmcp util not found"   ; return; }
    dest=$buildroot/DSK; dskname=$dest/SIGMV$vol.DSK
    cd                   $builddir                  &> /dev/null 1>&2
    mkdir -p             $dest                      &> /dev/null 1>&2
    [[ -f                $dskname ]] && rm $dskname &> /dev/null 1>&2  # remove any previous version

    # build archive
    mkfs.cpm -f ibm-3740 $dskname                   &> /dev/null 1>&2
    cpmcp -f    ibm-3740 $dskname ./* 0:            &> /dev/null 1>&2
    touch -r .           $dskname                   &> /dev/null 1>&2  # set datestamp of DSK
    touch -d "19880315"  $dest                                         # set datestamp of DSK dir to date of most recent SIG/M volume
    
    # clean up
    cd -                                            &> /dev/null 1>&2
    echo "    $(basename $dskname)"
  }

# ------------
  lbr () {
# ------------
    which mklbr &> /dev/null 1>&2   || { echo "mklbr util not found"   ; return; }
    dest=$buildroot/LBR; lbrname=$dest/SIGMV$vol.LBR ; recipe=$dest/$vol.rcp
    cd                   $builddir                  &> /dev/null 1>&2
    mkdir -p             $dest                      &> /dev/null 1>&2
    [[ -f                $lbrname ]] && rm $lbrname &> /dev/null 1>&2  # remove any previous version

    # build archive
    echo                "$lbrname"       > $recipe
    for j in *; do echo "$builddir/$j?$(echo $j | tr '_' '/')"  >> $recipe; done
    mklbr                $recipe
    rm                   $recipe
    
    # The version of mklbr I'm using doesn't translate _ to / when creating the LBR. So do it manually.
    # UPDATE: Turns out mklbr can do the translation; I've updated to code above and this is now obsolete.

#    for j in ./*; do {
#      oldname=$(echo $(basename $j) | cut -d'.' -f1)                              # filename with _
#      newname=$(echo $oldname | tr '_' '/')                                       # filename with /
#      [[ ! "$oldname" == "$newname" ]] && sed -i "s|$oldname|$newname|g" $lbrname # could also do something like echo $newname | grep "/"
#      }
#    done

    touch -r .           $lbrname                   &> /dev/null 1>&2  # set datestamp of LBR
    touch -d "19880315"  $dest                                         # set datestamp of LBR dir to date of most recent SIG/M volume (i.e., vol 310)

    # clean up
    cd -                                            &> /dev/null 1>&2
    echo "    $(basename $lbrname)"
  }
  
# ------------
  archives () {
# ------------
    echo ""
    echo "  Archives"
    echo "    ----"
    ark; dsk; lbr 
    echo "    ----"
  }

# ------------
  remove () {
# ------------
    echo ""
    echo "  Remove"
    echo "    ----"
    while [[ ! -z $1 ]]; do
     for i in $1; do
       echo "    $i"
       rm $builddir/$i > /dev/null 1>&2
     done
     shift
    done 
    echo "    ----"
  }
  
# ------------
  pad () {
# ------------

  # Under CP/M all files were stored in 128-byte records, such that files which were not a multiple of 128 bytes
  # in length were padded with garbage to the next 128-byte boundary (If the files were originally copied to 
  # fresh disks, the padding consisted of 1AH bytes). Over many years of passing through various file systems, 
  # many of the text files in the SIG/M collection have lost that additional padding, resulting in files which no
  # match the original CRC values. This routine will pad any file whose length is not an exact multiple of 128 to 
  # the next 128-byte multiple with 1AH. This fixes most CRC mismatches.

    sudo chmod 777 $builddir/*   # Some vols (e.g., 104) give "Permission denied"

    echo ""
    echo "  Padding"
    echo "    ----"

    for f in $builddir/*; do
      count=$((128-$(($(ls -l $f | cut -d' ' -f5)%128)))) # number of bytes needed to next 128
      [[ $count -eq 128 ]] && count=0 || echo "    $(basename $f) with $count bytes" # Reset to 0 to avoid padding files that are already a multiple of 128 bytes
 
      for (( c=1; c<=$count; c++)); do 
        printf "%b" '\x1A' >> $f
      done  
    done  

    echo "    ----"

  }
  
# ------------
  notes () {
# ------------
    echo ""
    echo "  Notes"
    echo "    ----"
    for i in "$@"; do echo "    $i"; done
    echo "    ----"
  }

#-----
# MAIN
#-----

# All volumes' CRCs and filenames have been manually compared to crckfile/crcklist/-catalog.

  case $vol in # Build the specified volume.
  
    # General process: mount the source, copy the files, dismount the source, pad the files, set datestamps, build ARK/LBR/DSK archives, and finally show the file CRCs.
    # Reminder (cuz I'm always in danger of forgetting why): datefiles must run before archives so that files have proper dates before they're archived. 
  
    001) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    002) copyfiles cpmug    ; pad;                    rename "./SIG_M.$vol ./-CATALOG.$vol"                            ; datefiles; archives; checkcrc ;;
    003) copyfiles oak      ; source wc; head -n 15 $src/../vol015/sigmlog.003 > $builddir/-CATALOG.$vol; tail -n 12 $src/../vol015/sigmlog.003 > $builddir/ABSTRACT.$vol; dismount; pad; datefiles; archives; checkcrc ;;
    004) copyfiles cpmug    ; pad; remove SIG_M.LIB;  rename "DU_8_12.ASM DU-8_12.ASM" "BDOS_PAT.ASM BDOS-PAT.ASM"     ; datefiles; archives; checkcrc ;;
    005) copyfiles cpmug    ; pad; remove SIG_M.LIB;  rename "CP_M_NET.MSG CP_M-NET.MSG"                               ; datefiles; archives; checkcrc ;;
    006) copyfiles cpmug    ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    007) copyfiles nicholson; pad; remove SIG_M.LIB                                                                    ; datefiles; archives; checkcrc ;;
    008) copyfiles cpmdosgg ; pad; remove SIG_M.LIB                                                                    ; datefiles; archives; checkcrc ;;
    009) copyfiles nicholson; pad; remove SIG_M.LIB                                                                    ; datefiles; archives; checkcrc ;;
    010) copyfiles nicholson; pad; remove SIG_M.LIB                                                                    ; datefiles; archives; checkcrc ;;
    011) copyfiles cpmug    ; pad; remove SIG_M.LIB                                                                    ; datefiles; archives; checkcrc ;;
    012) copyfiles cpmdosgg ; pad; remove SIG_M.LIB                                                                    ; datefiles; archives; checkcrc ;;
    013) copyfiles nicholson; pad; remove SIG_M.LIB                                                                    ; datefiles; archives; checkcrc ;;
    014) copyfiles cpmdosgg ; pad; remove SIG_M.LIB                                                                    ; datefiles; archives; checkcrc ;;
    015) copyfiles cpmug    ; pad;                    rename "./-CATALOG.015  CATALOG.015" "DCATALOG.015 ./-CATALOG.015";datefiles; archives; checkcrc ;;
    016) copyfiles cpmdosgg ; pad; remove SIG_M.LIB;  rename "DU_*" "FILE_*"                                           ; datefiles; archives; checkcrc ;;
    017) copyfiles cpmdosgg ; pad; remove SIG_M.LIB;  rename "SORTV_*" "./_CATALOG.ACK ./-CATALOG.ACK"                 ; datefiles; archives; checkcrc ;;
    018) copyfiles nicholson; pad; remove SIG_M.LIB;  rename "CATALOG.ACK  ./-CATALOG.ACK"                             ; datefiles; archives; checkcrc ;;
    019) copyfiles nicholson; pad;                    rename "CATALOG.ACK ./-CATALOG.ACK";                               datefiles; archives; checkcrc ;; # CRCK.COM, SIG/M.LIB: in CRCKFILE.019 and on disk but not -CATALOG.019. CRCKFILE.019: in -CATALOG.019 and on disk but not in CRCKFILE.019
    020) copyfiles nicholson; pad                                                                                      ; datefiles; archives; checkcrc ;; # -CATALOG.020 CRC mismatch; CRCK.COM not listed in -CATALOG; CRCKFILE.020 not listed in CRCKFILE.
    021) copyfiles sourdough; pad                                                                                      ; datefiles; archives; checkcrc ;;
    022) copyfiles sourdough; pad; remove SIG_M.LIB                                                                    ; datefiles; archives; checkcrc ;; # LESSON4 in CRCKFILE, not in -CATALOG. TEST.DAT in CRCKFILE, not in -CATALOG.
    023) copyfiles nicholson; pad                                                                                      ; datefiles; archives; checkcrc ;; # SIG_M.LIB in CRCKFILE, not in -CATALOG. CRCK.COM in CRCKFILE, not in -CATALOG. CRCKFILE in -CATALOG, not in CRCKFILE.
    024) copyfiles nicholson; pad;                    rename "CATALOG.ACK ./-CATALOG.ACK"                              ; datefiles; archives; checkcrc ;;
    025) copyfiles nicholson; pad;                    rename "CATALOG.ACK ./-CATALOG.ACK"                              ; datefiles; archives; checkcrc ;;
    026) copyfiles cpmdosgg ; pad;           rename "EL_*" "./_CATA026.ACK ./-CATA026.ACK" "NAME-ADD.DOC NAME&ADD.DOC" ; datefiles; archives; checkcrc ;;
    027) copyfiles cpmdosgg ; pad;                    rename "./_CATA027.ACK ./-CATA027.ACK"                           ; datefiles; archives; checkcrc ;;
    028) copyfiles cpmdosgg ; pad; rename "LIFE_*" "NAME_*" "_CATA028.ACK ./-CATA028.ACK" "NAME-ADD.DOC NAME&ADD.DOC"  ; datefiles; archives; checkcrc ;;
    029) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    030) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    031) copyfiles nicholson; pad;                    rename "CATA031.ACK ./-CATA031.ACK"                              ; datefiles; archives; checkcrc  ; notes "Only Nicholson yields fully matching CRCs." ;;
    032) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    033) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    034) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    035) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    036) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    037) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    038) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    039) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc  ; notes "-CATALOG.039 CRC mismatch" ;;
    040) copyfiles cpmdosgg ; pad;                    rename " MENU_*" "RUN80_*" "VMAP_*"                              ; datefiles; archives; checkcrc ;;
    041) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    042) copyfiles cpmdosgg ; pad;                    rename "HD_*"                                                    ; datefiles; archives; checkcrc ;;
    043) copyfiles oak      ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    044) copyfiles cpmdosgg ; pad;                    rename "DU_*" "SD_*"  "WASH_*"                                   ; datefiles; archives; checkcrc  ; notes "-CATALOG.044 lists WASH-16.ASM; however, all known extanct" "SIG/M collections have WASH-14.ASM." ;;
    045) copyfiles cpmdosgg ; pad; remove READ.ME                                                                      ; datefiles; archives; checkcrc ;; # README isn't in any file list, and is just a portion of DUNGEO.DOC in any case. Bye-bye.
    046) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    047) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    048) copyfiles cpmdosgg ; pad;                    rename "CRCKLIST.043 CRCKLIST.048"                               ; datefiles; archives; checkcrc ;;
    049) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc  ; notes "Corruption in -CATALOG.049 makes it impossible to" "extract MDBSGETM.PLI's CRC." ;;
    050) copyfiles cpmdosgg ; pad; rename "TALK_.LIB TALK@.LIB" "VOIC_.DOC VOIC@.DOC" "VOIC_.LIB VOIC@.LIB" "VOIC_EQU.LIB VOIC@EQU.LIB"; datefiles; archives; checkcrc ;; # _ replaces @ instead of /; need to account for this
    051) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;; 
    052) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;; 
    053) copyfiles cpmdosgg ; pad;                              rename "X_UTIL.SAM X\$UTIL.SAM" "READ_ME.DOC READ-ME.DOC"  ; datefiles; archives; checkcrc ;; 
    054) copyfiles cpmdosgg ; pad;                              rename "I_O_CAP.ADD I_O-CAP.ADD" "I_O_CAP.ASM I_O-CAP.ASM" ; datefiles; archives; checkcrc; notes "CRC false flag: READ.ME incorrectly reports a mismatched CRC. In " "fact, its CRC is correct."  ;; 
    055) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;; 
    056) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc; notes "CRC false flag: READ.ME incorrectly reports a mismatched CRC. In " "fact, its CRC is correct."  ;; 
    057) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc; notes "CRC false flag: READ.ME incorrectly reports a mismatched CRC. In " "fact, its CRC is correct."  ;; 
    058) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;; 
#   059) copyfiles oak      ; pad                                                                                      ; datefiles; archives; checkcrc  ; notes "Unfortunately, none of the extant sources" "yields matching CRCs." ;;     
    059) source cpmdosgg
#   read -p "ENTER..."
         for f in $tempdir/cpm06/627/* ; do cp $f $builddir/$(basename $f | tr 'a-z' 'A-Z') >/dev/null 2>&1; done
         cp $tempdir/cpm11/1114/read.me $builddir/READ2.ME
         dismount
         copyfiles oak ./-CATALOG.059 SIG_M.LIB READ.ME SIG-M.LIB CRCK.COM
         remove _CATALOG.* _HISTORY.018 CRCKLIST.CRC CRCK4.COM
         pad
         datefiles
         archives
         checkcrc
         notes "Thanks to Martin from comp.os.cpm for finding un- " "corrupted copies of these files in cpmdosgg."
         ;;     
#   060) source     cpmdosgg ; copyfiles; dismount; source oak ; cp $tempdir/SIG-M.LIB $builddir/; dismount; pad; remove "CRCK.COM SIG_M.LIB"; rename "*_*" "SQ-USQ15.DOC SQ_USQ15.DOC" ; datefiles; archives; checkcrc;   notes "Only cpmdosgg's RBBS22.DOC and RBSUTL22.ASC" "match CRCs. However it lacks SIG/M.LIB, which" "is pulled from OAK." ;;
    060) copyfiles cpmdosgg ; copyfiles oak SIG-M.LIB ; pad; remove "CRCK.COM SIG_M.LIB"; rename "*_*" "SQ-USQ15.DOC SQ_USQ15.DOC"     ; datefiles; archives; checkcrc;   notes "Only cpmdosgg's RBBS22.DOC and RBSUTL22.ASC" "match CRCs. However it lacks SIG/M.LIB, which" "is pulled from OAK." ;;
    061) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc; notes "CRC false flag: READ.ME incorrectly reports a mismatched CRC. In " "fact, its CRC is correct."  ;; 
    062) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    063) copyfiles cpmdosgg ; pad;                    rename "NAD_*"                                                   ; datefiles; archives; checkcrc ;;
    064) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    065) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    066) copyfiles cpmdosgg ; pad; sed -i 's:CMMMAND:COMMAND:g' $builddir/ZCPR_14.ASM; rename "ZCPR*" "SD_*"           ; datefiles; archives; checkcrc ;; # At some point after CRCs were generated, a single byte in ZCPR_14.ASM was altered. Changing it back restores the proper CRC.
    067) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    068) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    069) copyfiles cpmdosgg ; pad;                    rename "CUB__.DAT CUB++.DAT"                                     ; datefiles; archives; checkcrc ;;
    070) copyfiles cpmdosgg ; pad;                    rename "A_*" "STARTRE_.NBP STARTRE\$.NBP"                        ; datefiles; archives; checkcrc ;;
    071) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    072) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    073) copyfiles cpmdosgg ; pad;                    rename "COMP_*" "PAGE_*" "VD*"                                   ; datefiles; archives; checkcrc ;;
    074) copyfiles cpmdosgg ; pad;                    rename "CLOCK_*"                                                 ; datefiles; archives; checkcrc ;;
    075) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    076) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    077) copyfiles cpmdosgg ; pad;                    rename "*CPR_*"                                                  ; datefiles; archives; checkcrc ;;
    078) copyfiles cpmdosgg ; pad;                    rename "*TALK1_*"                                                ; datefiles; archives; checkcrc ;;
    079) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
#   080) copyfiles oak      ; pad; for j in "ARTIL" "SAMPLE"; do for i in $builddir/$j-*; do mv $i $(echo $i | tr '-' '_'); done; done; datefiles; archives; checkcrc  ; notes "Unfortunately, none of the extant sources" "yields matching CRCs." ;;
    080) copyfiles cpmdosgg ; copyfiles oak PINUP82.CAL SIGHTRED.COM ; pad; remove *.081 CONSTS.* COPY.* D*.* FF.* GE*.* IM*.* PP.* PR*.* SP*.* *.TEX TP.* TY*.* X*.*; datefiles; archives; checkcrc  ; notes "Thanks to Martin in the comp.os.cpm forums for discovering" "compdosgg has the correct CRCs. But compdosgg has" "additional files that must be cleaned out." ;;
    081) copyfiles oak      ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    082) copyfiles oak      ; pad;                    rename "ABSTRACT.081 ABSTRACT.082"                               ; datefiles; archives; checkcrc ;;
    083) copyfiles cpmdosgg ; pad;                    rename "ICE_*.*"                                                 ; datefiles; archives; checkcrc ;;
#   084) source oak          ; copyfiles; dismount; source cpmdosgg ; cp $src/entrbbs.bas $builddir/ENTRBBS.BAS; dismount; pad; rename "FINDP.ASM FIND+.ASM" "FINDP.COM FIND+.COM" "XSTAMP.ASM XSTAM+.ASM" "XSTAMP.COM XSTAM+.COM" "CRC CRC.COM"   ; datefiles; archives; checkcrc ;;
    084) copyfiles oak      ; copyfiles cpmdosgg entrbbs.bas ; pad; rename "FINDP.ASM FIND+.ASM" "FINDP.COM FIND+.COM" "XSTAMP.ASM XSTAM+.ASM" "XSTAMP.COM XSTAM+.COM" "CRC CRC.COM"   ; datefiles; archives; checkcrc ;;
#   085) source cpmdosgg     ; copyfiles; dismount; source oak; cp $src/SIGNS.COM  $builddir/SIGNS.COM; cp -f $src/RUNOFF.COM $builddir/RUNOFF.COM; cp -f $src/PASDIR.PAS $builddir/PASDIR.PAS; cp -f $src/REMOVECC.PAS $builddir/REMOVECC.PAS; cp -f $src/TRIMCOLS.PAS $builddir/TRIMCOLS.PAS; cp -f $src/XSUB.COM $builddir/XSUB.COM; dismount; pad; datefiles; archives; checkcrc  ; notes "Must mix and match CPMDOSGG and OAK" "to complete a set of intact files." ;;
    085) copyfiles cpmdosgg ; copyfiles oak SIGNS.COM RUNOFF.COM PASDIR.PAS REMOVECC.PAS TRIMCOLS.PAS XSUB.COM ; pad; datefiles; archives; checkcrc  ; notes "Must mix and match CPMDOSGG and OAK" "to complete a set of intact files." ;;
    086) copyfiles oak      ; pad; remove "U.COM";    rename "FAST2.COM _.COM"                                         ; datefiles; archives; checkcrc  ; notes "Both CPMDOSGG and OAK have U.COM" "which is not listed in -CATALOG." "It is retained for now." ;;
#   087) source cpmdosgg     ; copyfiles; dismount; source oak; cp $src/BDSCAT.AQL $builddir/; cp $src/RATFOR.HLP $builddir/; dismount; rename "DISPLAY_.ASM DISPLAY+.ASM" "DISPLAY_.COM DISPLAY+.COM" "TYP_.ASM TYP+.ASM" "TYP_.COM TYP+.COM" "THIS_*"; datefiles; archives; checkcrc ;;
    087) copyfiles cpmdosgg ; copyfiles oak BDSCAT.AQL RATFOR.HLP ; rename "DISPLAY_.ASM DISPLAY+.ASM" "DISPLAY_.COM DISPLAY+.COM" "TYP_.ASM TYP+.ASM" "TYP_.COM TYP+.COM" "THIS_*"; datefiles; archives; checkcrc ; notes "BDSCAT.AQL, RATFOR.HLP CRC mismatch, so copies pulled from OAK." ;;
    088) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    089) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc  ;  notes "SYSLIBI.WS is on disk but not listed in -CATALOG." ;;
    090) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    091) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc  ;  notes "READ.ME is on disk but not listed in -CATALOG." ;;
    092) copyfiles cpmdosgg ; pad; rename "LITL_ADA.ASM LITL-ADA.ASM" "LITL_ADA.DOC LITL-ADA.DOC" "LITL_ADA.PRN LITL-ADA.PRN" "RBBS_USE.DOC RBBS-USE.DOC" ; datefiles; archives; checkcrc ;;
#   093) source cpmdosgg ; copyfiles; dismount; source oak; cp $src/trsmodem.com $builddir/TRSMODEM.COM; dismount; pad  ; datefiles; archives; checkcrc ;;
    093) copyfiles cpmdosgg ; copyfiles oak trsmodem.com ; pad                                                        ; datefiles; archives; checkcrc ;;
    094) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    095) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    096) copyfiles cpmdosgg ; pad; rename "CRCK_51.A86 CRCK-51.A86" "FILE_EXT.A86 FILE-EXT.A86" "XDIR_A86.DOC XDIR-A86.DOC" ; datefiles; archives; checkcrc ;;
    097) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    098) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    099) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ; notes "CRC false flag: ZEX.ZEX's CRC is correct." ;;
    100) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    101) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    102) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    103) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
#   104) source oak          ; copyfiles; cp $tempdir/sigm/vol104/sig/m.lib $builddir/SIG_M.LIB; dismount; pad                               ; datefiles; archives; checkcrc ;;
    104) copyfiles oak      ; copyfiles oak sig/m.lib; pad;               rename "M.LIB SIG_M.LIB"                                         ; datefiles; archives; checkcrc ; notes "I don't know where the CRC compare value is from. I" "don't know if ZCPR2.IDX is correct." ;;
    105) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    106) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    107) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    108) copyfiles cpmdosgg ; source cpmdosgg ; cp $tempdir/cpm11/1107/crc.com $builddir/CRC.COM ; dismount; pad; rename "Z2SYS_1.MOD Z2SYS-1.MOD" ; datefiles; archives; checkcrc ;;
    109) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc  ; notes "USERMAN1,3,4,5 are listed, but not USERMAN2.TXT" ;;
    110) copyfiles cpmdosgg ; pad;                    rename "*_*"                                                     ; datefiles; archives; checkcrc  ; notes "SIGN_ON.ACG, TWO_REC.FMT not in -CATALOG." ;;
    111) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    112) copyfiles cpmdosgg ; pad;                    rename "*_*" "RBBS-I-O.NQW RBBS-I_O.NQW"                         ; datefiles; archives; checkcrc ;;
    113) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    114) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc; notes "CRC false flag: READ.ME's CRC is correct." ;; 
    115) copyfiles cpmdosgg ; pad;                    rename "*_*"                                                     ; datefiles; archives; checkcrc ;;
    116) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    117) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc  ; notes "USQ.COM not listed in -CATALOG." ;;
    118) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    119) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    120) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    121) copyfiles cpmdosgg ; pad;                    rename "MDM709C_.AQM MDM709C+.AQM" "SD_*.*"                      ; datefiles; archives; checkcrc ;;
    122) copyfiles cpmdosgg ; pad;                    rename "DU2_*" "./ZCPR2.IDX ./-ZCPR2.IDX"                        ; datefiles; archives; checkcrc ;;
    123) copyfiles cpmdosgg ; pad;                    rename "FIND_*"                                                  ; datefiles; archives; checkcrc ;;
    124) copyfiles cpmdosgg ; pad;                    rename "ZCPR2_*"                                                 ; datefiles; archives; checkcrc ;;
    125) copyfiles cpmdosgg ; pad; remove __SIG_M.125;rename "ZCPR2_*"                                                 ; datefiles; archives; checkcrc ;;
    126) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    127) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    128) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    129) copyfiles oak      ; copyfiles oak db2sig/m.lbr; pad; remove CRCKLIST.CRC; rename "M.LBR DB2SIG_M.LBR"       ; datefiles; archives; checkcrc  ; notes "CPMDOSGG seems an earlier version of SIG/M. -CATALOG" "lists DB2SIG/M.LBR (0E47), but the disk holds instead" "its expanded contents. OTOH, OAK/WC have DB2SIG/M.LBR" "(51C0) & matching -CATALOGs. No known extant ver of" "(0E47). Compares of CPMDOSGG files w/OAK LBR contents" "reveals significant CRC differences. I've chosen to" "go with OAK for this volume." ;;
    130) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    131) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    132) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    133) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    134) copyfiles cpmdosgg ; pad;                    rename "GLOBALS.RN_ GLOBALS.RN$" "PASZCODE.RN_ PASZCODE.RN$"     ; datefiles; archives; checkcrc ;;
    135) copyfiles cpmdosgg ; pad;                    rename "DIR_*"                                                   ; datefiles; archives; checkcrc  ; notes "TEST.SUB not in -CATALOG." ;;
    136) copyfiles cpmdosgg ; pad;                    rename "BB_*.*"                                                  ; datefiles; archives; checkcrc ;;
    137) copyfiles cpmdosgg ; pad;                    rename "MP_*"                     ; touch $builddir/MP-SIMUL.IN2 ; datefiles; archives; checkcrc  ; notes "-CATALOG lists a 0-byte MP-SIMUL.IN2, which is miss-" "ing from some collections. It is recreated here." ;;
    138) copyfiles cpmdosgg ; pad;                    rename "MP_DEMO.LBR MP-DEMO.LBR"                                 ; datefiles; archives; checkcrc ;;
    139) copyfiles cpmdosgg ; pad;                    rename "UN_PROT.BAS UN-PROT.BAS"                                 ; datefiles; archives; checkcrc ;;
    140) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    141) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    142) copyfiles cpmdosgg ; pad;                    rename "*_*" "SFA-SAV.0 SFA_SAV.0"                               ; datefiles; archives; checkcrc ;;
    143) copyfiles cpmdosgg ; pad;                    rename "PACKET_*"                                                ; datefiles; archives; checkcrc ;;
    144) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    145) copyfiles cpmdosgg ; pad;                    rename "*_*"                                                     ; datefiles; archives; checkcrc ;;
    146) copyfiles cpmdosgg ; pad;                    rename "SD_48B.A86 SD-48B.A86" "SD_48B.CMD SD-48B.CMD"           ; datefiles; archives; checkcrc ;;
    147) copyfiles cpmdosgg ; pad;                    rename "FILE_*" "CRCK_*" "WM_*"                                  ; datefiles; archives; checkcrc ;;
    148) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    149) copyfiles cpmdosgg ; pad;                    rename "MODEM7_*" "UNIX_*"                                       ; datefiles; archives; checkcrc ;;
    150) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    151) copyfiles cpmdosgg ; pad;                    rename "DSK7_*" "MBOOT_*" "FMT_*" "MODEM_*"                      ; datefiles; archives; checkcrc ;;
    152) copyfiles cpmdosgg ; pad;                    rename "DU_*.*"                                                  ; datefiles; archives; checkcrc ;;
    153) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    154) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    155) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc  ; notes "ABSTRACT.155 missing from all collections." ;;
    156) copyfiles cpmdosgg ; pad;                    rename "SQ_*"                                                    ; datefiles; archives; checkcrc ;;
    157) copyfiles cpmdosgg ; pad;                    rename "Z80_*"                                                   ; datefiles; archives; checkcrc ;;
    158) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    160) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    159) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    161) copyfiles cpmdosgg ; pad;                    rename "DU_*" "TYPER_*"                                          ; datefiles; archives; checkcrc ;;
    162) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    163) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    164) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc  ; notes "READTHIS not in -CATALOG." ;;
    165) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc  ; notes "READTHIS not in -CATALOG." ;;
    166) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc  ; notes "READTHIS not in -CATALOG." ;;
    167) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    168) copyfiles cpmdosgg ; pad;                    rename "*_*"                                                     ; datefiles; archives; checkcrc  ; notes "READTHIS not in -CATALOG." ;;
    169) copyfiles cpmdosgg ; pad;                    rename "M7*"                                                     ; datefiles; archives; checkcrc ;;
    170) copyfiles cpmdosgg ; pad;                    rename "M7*" "M7AC-3.AQM M7AC+3.AQM"                             ; datefiles; archives; checkcrc ;;
    171) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
#   172) source cpmdosgg     ; copyfiles; dismount; source sourdough; cp $src/disk3.asm $builddir/DISK3.ASM; dismount; pad; rename "DU_*" "OKI_*"; datefiles; archives; checkcrc ;;
    172) copyfiles cpmdosgg ; copyfiles sourdough disk3.asm; pad;     rename "DU_*" "OKI_*"                           ; datefiles; archives; checkcrc ;;
    173) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc  ; notes "READTHIS not in -CATALOG." ;;
    174) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    175) copyfiles cpmdosgg ; pad;                    rename "F47_*" "MODEM_*"                                         ; datefiles; archives; checkcrc ;;
    176) copyfiles cpmdosgg ; pad;                    rename "DRI_*" "DU_*" "SD_*"                                     ; datefiles; archives; checkcrc ;;
    177) copyfiles cpmdosgg ; pad;                    rename "MY_*"; for i in $builddir/WS_*; do mv $i $(echo $i | tr '_' '$'); done ; datefiles; archives; checkcrc ;;
    178) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    179) copyfiles cpmdosgg ; pad;                    rename "BIOS3_.DQC BIOS3+.DQC"                                   ; datefiles; archives; checkcrc  ; notes "CARCHIVE.DQC not listed in -CATALOG." ;;
    180) copyfiles cpmdosgg ; pad;                    rename "*_*"                                                     ; datefiles; archives; checkcrc ;;
    181) copyfiles cpmdosgg ; pad;                    rename "*_*"                                                     ; datefiles; archives; checkcrc  ; notes "CXREF.HQP not listed in -CATALOG. File indices in -CATALOG.182 are messed up; fixed in rebuild." ;;
    182) copyfiles cpmdosgg ; pad;                    rename "NS_*" "TAG_*"                                            ; datefiles; archives; checkcrc ;;
    183) copyfiles cpmdosgg ; pad;                    rename "READ_*"                                                  ; datefiles; archives; checkcrc ;;
    184) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    185) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    186) copyfiles cpmdosgg ; pad;                    rename "CRC_*"                                                   ; datefiles; archives; checkcrc; notes "CRC false flag: SHOW.COM's and ZEX.ZEX's CRCs are correct."  ;; 
    187) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    188) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    189) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    190) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    191) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    192) copyfiles cpmdosgg ; pad;                    rename "SYS2*"                                                   ; datefiles; archives; checkcrc ;;
    193) copyfiles cpmdosgg ; pad;                    rename "PAF*"                                                    ; datefiles; archives; checkcrc ;;
    194) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    195) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc  ; notes "-CATALOG mis-lists DELBR.COM as DELRB.COM." ;;
    196) copyfiles cpmdosgg ; pad;                    rename "SD_*"                                                    ; datefiles; archives; checkcrc ;;
    197) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc  ; notes "-CATALOG mis-lists DELBR.COM as DELIB.COM." ;;
    198) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    199) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    200) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    201) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    202) copyfiles cpmdosgg ; pad;                    rename "RSA_*"                                                   ; datefiles; archives; checkcrc ;;
    203) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    204) copyfiles cpmdosgg ; pad;                    rename "F83_*"                                                   ; datefiles; archives; checkcrc ;;
    205) copyfiles cpmdosgg ; pad;                    rename "F83_*"                                                   ; datefiles; archives; checkcrc ;;
    206) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    207) copyfiles cpmdosgg ; pad;                    rename "LU86_*" "APC_DUMP.LBR APC-DUMP.LBR"                      ; datefiles; archives; checkcrc ;;
    208) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    209) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    210) copyfiles cpmdosgg ; pad;                    rename "CRC_64.AQ6 CRC-64.AQ6"                                   ; datefiles; archives; checkcrc ;;
    211) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    212) copyfiles cpmdosgg ; pad; rename "CPM2__.LBR CPM2-+.LBR" "FIND_2.LBR FIND+2.LBR" "UNERA_.LBR UNERA+.LBR" "*_*"; datefiles; archives; checkcrc ;;
    213) copyfiles cpmdosgg ; pad;                    rename "LBR_*"                                                   ; datefiles; archives; checkcrc ;;
    214) copyfiles cpmdosgg ; pad;                    rename "LBR_*"                                                   ; datefiles; archives; checkcrc ;;
    215) copyfiles cpmdosgg ; pad;                    rename "LBR_*"                                                   ; datefiles; archives; checkcrc ;;
    216) copyfiles cpmdosgg ; pad;                    rename "M8NM_*"                                                  ; datefiles; archives; checkcrc ;;
    217) copyfiles cpmdosgg ; pad;                    rename "M8??_*"                                                  ; datefiles; archives; checkcrc ;;
    218) copyfiles cpmdosgg ; pad;                    rename "MX?_*"                                                   ; datefiles; archives; checkcrc ;;
    219) copyfiles cpmdosgg ; pad;                    rename "MX?_*"                                                   ; datefiles; archives; checkcrc ;;
    220) copyfiles cpmdosgg ; pad;                    rename "MX?_*" "MXO-R-10.AQM MXO-R+10.AQM"                       ; datefiles; archives; checkcrc ;;
    221) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    222) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    223) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    224) copyfiles cpmdosgg ; pad;                    rename "C80V_*"                                                  ; datefiles; archives; checkcrc ;;
    225) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    226) copyfiles cpmdosgg ; pad;                    rename "DRI_*"                                                   ; datefiles; archives; checkcrc ;;
    227) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    228) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    229) copyfiles cpmdosgg ; pad;                    rename "SAVE0_*" "APC_*"                                         ; datefiles; archives; checkcrc ;;
    230) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    231) copyfiles cpmdosgg ; pad;                    rename "CP_M_.LBR CP-M+.LBR"                                     ; datefiles; archives; checkcrc ;;
    232) copyfiles cpmdosgg ; pad;                    rename "M7BBS_.AQM M7BBS+.AQM"                                   ; datefiles; archives; checkcrc ;;
    233) copyfiles cpmdosgg ; pad;                    rename "BOY_*"                                                   ; datefiles; archives; checkcrc  ; notes "CLEANUP.DQC not listed in -CATALOG." ;;
    234) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    235) copyfiles cpmdosgg ; pad;                    rename "BOKA_EI.BQS BOKA&EI.BQS" "FORTH_*"                       ; datefiles; archives; checkcrc ;;
    236) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    237) copyfiles cpmdosgg ; pad;                    rename "PILOT_*"                                                 ; datefiles; archives; checkcrc ;;
    238) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    239) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    240) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc  ; notes "EPRINT.ZSM is unlisted in -CATALOG." ;;
    241) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    242) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    243) copyfiles oak      ; pad                                                                                      ; datefiles; archives; checkcrc  ; notes "CRC mismatch: GETNAME.PRO, VISCOS1 .DAT." ;;
    244) copyfiles cpmdosgg ; pad;                    rename "LPAK1?_*"                                                ; datefiles; archives; checkcrc ;;
    245) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    246) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    247) copyfiles cpmdosgg ; pad;                    rename "DU_*" "Z19_*"                                            ; datefiles; archives; checkcrc ;;
    248) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    249) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    250) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc  ; notes "Though VDO25.LBR is not listed in -CATALOG" "and seems out of place, it is retained.    " ;;
    251) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    252) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    253) copyfiles oak      ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    254) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    255) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    256) copyfiles cpmdosgg ; pad;                    rename "TFR_*" "TRANS_*"                                         ; datefiles; archives; checkcrc ;;
    257) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    258) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    259) copyfiles oak      ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    260) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    261) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    262) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    263) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    264) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    265) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    266) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    267) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    268) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    269) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    270) copyfiles cpmdosgg ; pad;                    rename "FS_*"                                                    ; datefiles; archives; checkcrc; notes "CRC false flag: LIB.LIB's CRC is correct."  ;; 
    271) copyfiles cpmdosgg ; pad;                    rename "FP_*"                                                    ; datefiles; archives; checkcrc ;;
    272) copyfiles cpmdosgg ; pad;                    rename "*_*"                                                     ; datefiles; archives; checkcrc ;;
    273) copyfiles cpmdosgg ; pad;                    rename "*_*"                                                     ; datefiles; archives; checkcrc ;;
    274) copyfiles cpmdosgg ; pad;                    rename "*_*"                                                     ; datefiles; archives; checkcrc ;;
    275) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    276) copyfiles cpmdosgg ; pad;                    rename "*_*"                                                     ; datefiles; archives; checkcrc ;;
    277) copyfiles cpmdosgg ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    278) copyfiles oak      ; pad                                                                                      ; datefiles; archives; checkcrc ;;
    279) copyfiles oak      ; source cpmdosgg; for i in comp.asm label.mac tail.asm; do cp $tempdir/cpm12/1279/$i $builddir/$(echo $i | tr 'a-z' 'A-Z'); done ; dismount; pad ; datefiles; archives; checkcrc  ;;
    280) copyfiles oak      ; pad                                                                                      ; datefiles; archives; checkcrc  ; notes "MULTICOL.PAS CRC mismatch." ;;
    281) copyfiles sourdough; pad                                                                                      ; datefiles; archives; checkcrc  ; notes "CRC mismatch: CMPCODE.DOC, ZLOAD.DOC," "SNOOPY.FOR, FORT07.DAT." ;;
    282) copyfiles sourdough; pad                                                                                      ; datefiles; archives; checkcrc ;;
    283) copyfiles sourdough; pad                                                                                      ; datefiles; archives; checkcrc ;;
    284) copyfiles sourdough; pad                                                                                      ; datefiles; archives; checkcrc ;;
    285) copyfiles sourdough; pad                                                                                      ; datefiles; archives; checkcrc  ; notes "CRC mismatch: BROWSE.DOC, CURSOR.ASM," "SAVEREST.ASM, SAVEREST.DOC, TWENTY.ASM," "WORD-KEY.FIX.";;
    286) copyfiles sourdough; pad                                                                                      ; datefiles; archives; checkcrc ;;
    287) copyfiles sourdough; pad                                                                                      ; datefiles; archives; checkcrc ;;
    288) copyfiles sourdough; pad                                                                                      ; datefiles; archives; checkcrc ;;
    289) copyfiles sourdough; pad                                                                                      ; datefiles; archives; checkcrc  ; notes "CRC mismatch: RAMDSKRB.DOC." ;;
    290) copyfiles sourdough; pad                                                                                      ; datefiles; archives; checkcrc ;;
    291) copyfiles sourdough; copyfiles sourdough ../vol293/wipe.pas
         source sourdough
         for i in CLOCK.LIB CONCORD.PAS DELIB.PAS DIR.INC DWS.PAS ERRORS.PAS FREEDIR.INC FREE.INC FUNCKEYS.PAS IOERROR.PAS; do cp $tempdir/library_collections/dka_kaypro/900/913/$i $builddir/$(echo $i | tr 'a-z' 'A-Z'); done
         for i in MLABELS.PAS OKI.PAS                                                                                     ; do cp $tempdir/library_collections/dka_kaypro/900/914/$i $builddir/$(echo $i | tr 'a-z' 'A-Z'); done
         dismount
         pad; datefiles; archives; checkcrc
         ;;
    292) copyfiles sourdough
         source sourdough; for i in SIZE.PAS STRIP8.PAS; do cp $tempdir/library_collections/dka_kaypro/900/914/$i $builddir/$(echo $i | tr 'a-z' 'A-Z'); done; dismount
         pad; datefiles; archives; checkcrc 
         ;;
    293) copyfiles sourdough; pad                                                                                      ; datefiles; archives; checkcrc  ; notes "WIPE.PAS not listed in -CATALOG." "Wandered over from v291?" ;;
    294) copyfiles sourdough; pad                                                                                      ; datefiles; archives; checkcrc ;;
    295) copyfiles sourdough; pad                                                                                      ; datefiles; archives; checkcrc ;;
    296) copyfiles sourdough; pad                                                                                      ; datefiles; archives; checkcrc ;;
    297) copyfiles sourdough; pad                                                                                      ; datefiles; archives; checkcrc ;;
    298) copyfiles sourdough; pad                                                                                      ; datefiles; archives; checkcrc ;;
    299) copyfiles sourdough; pad;                    rename "KPHANDYP.LBR KPHANDY+.LBR"                               ; datefiles; archives; checkcrc  ; notes "-READ.ME not listed in -CATALOG." ;;
    300) copyfiles sourdough; pad                                                                                      ; datefiles; archives; checkcrc ;;
    301) copyfiles sourdough; pad                                                                                      ; datefiles; archives; checkcrc ;;
    302) copyfiles sourdough; pad; remove CRCKLIST.CRC                                                                 ; datefiles; archives; checkcrc ;;
    303) copyfiles sourdough; pad                                                                                      ; datefiles; archives; checkcrc ;;
    304) copyfiles sourdough; pad                                                                                      ; datefiles; archives; checkcrc ;;
    305) copyfiles sourdough; pad                                                                                      ; datefiles; archives; checkcrc ;;
    306) copyfiles sourdough; pad                                                                                      ; datefiles; archives; checkcrc ;;
    307) copyfiles sourdough; pad; remove ./-READ.ME; rename "RDIR15P.LBR RDIR15+.LBR"                                 ; datefiles; archives; checkcrc ;;
    308) copyfiles sourdough; pad                                                                                      ; datefiles; archives; checkcrc ;;
    309) copyfiles sourdough; pad                                                                                      ; datefiles; archives; checkcrc ;;
    310) copyfiles sourdough; pad                                                                                      ; datefiles; archives; checkcrc ;;
      *) echo Volume $vol not implemented yet. ;; # You should never see this.
  esac
  
#---------
# Clean up
#---------
  [[ -d $tempdir ]] && rm -rf $tempdir # in case it somehow got missed.
  cd - >/dev/null 2>&1
exit 0
